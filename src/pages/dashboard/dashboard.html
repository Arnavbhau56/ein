<div class="dashboard-container">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-content">
      <div class="navbar-left">
        <a href="https://ecell.in" target="_blank" rel="noopener noreferrer">
          <img src="assets/logo.png" alt="Logo" class="logo" />
        </a>
      </div>
      <div class="navbar-right">
        <button class="logout-btn" (click)="logout()">Logout</button>
      </div>
    </div>
  </nav>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading Dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <p>{{ error }}</p>
    <button (click)="fetchDashboardData()" class="retry-btn">Retry</button>
  </div>

  <div class="instructions">
  <app-instructions></app-instructions>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading && !error" class="dashboard-content">
    <!-- Main Dashboard Layout -->
    <div class="dashboard-layout">
      <!-- Left Section (65%) -->
      <div class="left-section">
        <!-- Personal Details Box -->
        <div class="dashboard-box personal-details-box">
          <div class="box-header">
            <h2 class="box-title">Personal Details</h2>
            <div class="box-actions">
              <button class="btn update-btn" (click)="openUpdateModal()">Update Details</button>
              <button class="btn template-btn" (click)="downloadTemplateCSV()">Template Students' CSV</button>
                             <label class="btn upload-btn" [class.disabled]="personalDetails?.csv_status === 'verified'" (click)="handleCSVUpload()">
                 Upload Students' CSV
                 <input type="file" accept=".csv" (change)="uploadCSV($event)" style="display: none;" [disabled]="personalDetails?.csv_status === 'verified'">
               </label>
            </div>
          </div>
          
          <div class="details-content" *ngIf="personalDetails">
            <div class="detail-row">
              <div class="detail-item">
                <label>Name:</label>
                <span>{{ personalDetails.poc_first_name }} {{ personalDetails.poc_last_name }}</span>
              </div>
              <div class="detail-item">
                <label>Email:</label>
                <span>{{ personalDetails.email }}</span>
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label>Contact:</label>
                <span>{{ personalDetails.contact }}</span>
              </div>
              <div class="detail-item">
                <label>School ID:</label>
                <span>{{ personalDetails.school_id }}</span>
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label>City:</label>
                <span>{{ personalDetails.school_city }}</span>
              </div>
              <div class="detail-item">
                <label>State:</label>
                <span>{{ personalDetails.school_state }}</span>
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item full-width">
                <label>Address:</label>
                <span>{{ personalDetails.school_address }}</span>
              </div>
            </div>
            <div class="detail-row">
              <div class="detail-item">
                <label>Exam Date:</label>
                <span>{{ personalDetails.exam_date }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Students Details Box -->
        <div class="dashboard-box students-details-box">
          <div class="box-header">
            <h2 class="box-title">Students Details</h2>
          </div>
          
          <div class="students-content" *ngIf="personalDetails">
                         <!-- CSV Status -->
             <div class="detail-item">
               <label>CSV Status:</label>
               <span>{{ getCsvStatusText(personalDetails.csv_status) }}</span>
             </div>

            <!-- CSV Issue (if any) -->
            <div class="csv-issue" *ngIf="personalDetails.csv_issue">
              <label>Issue:</label>
              <span class="issue-text">{{ personalDetails.csv_issue }}</span>
            </div>

                         <!-- Student Counts (only if verified) -->
             <div class="student-counts" *ngIf="personalDetails.csv_status === 'verified'">
               <h3>Student Distribution</h3>
               <div class="count-grid">
                 <div class="count-item">
                   <label>Total Students:</label>
                   <span class="count">{{ personalDetails.students_number || 0 }}</span>
                 </div>
                 <div class="count-item" *ngFor="let classData of getStudentClassData()">
                   <label>Class {{ classData.class }}:</label>
                   <span class="count">{{ classData.count }}</span>
                 </div>
               </div>
             </div>
          </div>
        </div>
      </div>

      <!-- Right Section (35%) -->
      <div class="right-section">
        <div class="dashboard-box updates-box">
          <div class="box-header">
            <h2 class="box-title">Updates</h2>
          </div>
          
          <div class="updates-content">
            <ol class="updates-list">
              <li *ngFor="let update of updates" class="update-item">
                {{ update.title }}
              </li>
            </ol>
            
            <div *ngIf="updates.length === 0" class="no-updates">
              <p>No updates available at the moment.</p>
            </div>
          </div>
        </div>
           </div>
   </div>
 </div>

  <!-- Update Modal -->
  <div class="modal-overlay" *ngIf="showUpdateModal" (click)="closeUpdateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Update Personal Details</h3>
        <button class="modal-close" (click)="closeUpdateModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <form class="update-form">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" [(ngModel)]="updateFormData.poc_first_name" name="firstName" required>
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" [(ngModel)]="updateFormData.poc_last_name" name="lastName" required>
            </div>
          </div>
          
                     <div class="form-row">
             <div class="form-group">
               <label for="contact">Contact</label>
               <input type="text" id="contact" [(ngModel)]="updateFormData.contact" name="contact" required>
             </div>
             <div class="form-group">
               <label for="schoolId">School ID</label>
               <input type="text" id="schoolId" [(ngModel)]="updateFormData.school_id" name="schoolId" required>
             </div>
           </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city">City</label>
              <input type="text" id="city" [(ngModel)]="updateFormData.school_city" name="city" required>
            </div>
            <div class="form-group">
              <label for="state">State</label>
              <input type="text" id="state" [(ngModel)]="updateFormData.school_state" name="state" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="address">Address</label>
            <textarea id="address" [(ngModel)]="updateFormData.school_address" name="address" required></textarea>
          </div>
          
                     <div class="form-row">
             <div class="form-group">
               <label for="schoolId">School ID</label>
               <input type="text" id="schoolId" [(ngModel)]="updateFormData.school_id" name="schoolId" required>
             </div>
             <div class="form-group">
               <label for="examDate">Exam Date</label>
               <select id="examDate" [(ngModel)]="updateFormData.exam_date" name="examDate" required>
                 <option value="">Select Exam Date</option>
                 <option value="20-09-2025">20-09-2025</option>
                 <option value="21-09-2025">21-09-2025</option>
               </select>
             </div>
           </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button class="btn cancel-btn" (click)="closeUpdateModal()">Cancel</button>
        <button class="btn update-modal-btn" (click)="updatePersonalDetails()">Update</button>
      </div>
    </div>
  </div>
</div>
